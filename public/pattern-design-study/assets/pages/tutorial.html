<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Tutorial</title>
    <script src="../../../revisitUtilities/revisit-communicate.js"></script>
    <script type="text/javascript" src="/pattern-design-study/assets/lib/jquery.min.js"></script>
    <script type="text/javascript" src="/pattern-design-study/assets/lib/d3.v7.min.js"></script>
    <script type="text/javascript" src="/pattern-design-study/assets/lib/bootstrap-tour-standalone.min.js"></script>
    <script src="/pattern-design-study/assets/tools/loading.js"></script>

    <link rel="stylesheet" href="/pattern-design-study/assets/lib/bootstrap.css">
    <link rel="stylesheet" href="/pattern-design-study/assets/lib/bootstrap-tour-standalone.min.css">

    <link rel="stylesheet" type="text/css" href="/pattern-design-study/assets/pages/texture_style.css">

    <script type = "text/javascript" >
        //when you click the back button of the browser, this script prevent you from going bac
        function preventBack(){window.history.forward();}
        setTimeout("preventBack()", 0);
        window.onunload=function(){null};
    </script>
    <style>
        .btn-outline-secondary{
            border-color: #6c757d;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="row bg-light">
        <div class="col">
            <h2>Get Familiar with the Texture Design Tool</h2>
            <div id='tutorial_finished' style="display: none" class="textContent">
                <p>Now you can play with the tool and try each function out. </p>
                <p>Once you are familiar with the tool, click the <span style="color:#1E90FF;font-weight: bold">Start Real Experiment</span> button at the bottom right of the page to start the real experiment.</p>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col">
            <div id="toolbar"></div>
        </div>
    </div>

    <div class="row">
        <div class="col-auto legend_drag_div">
            <div id="legend"></div>
            <div id="dragdrop" class="bg-light"></div>
        </div>
        <div class="col-auto">
            <div id="chartDiv" class="chartDiv"></div>
            <div id="outlineDiv" style="padding-left: 200px"></div>
        </div>
        <div class="col-auto">
            <div id="controllerDiv">
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <!-- <button id="tutorial_next_btn" class="btn btn-primary float-end">Start Real Experiment</button> -->
        </div>
    </div>
</div>


<script src="/pattern-design-study/assets/pages/texture_functions.js"></script>
<script src="/pattern-design-study/assets/pages/texture_constants.js"></script>
<script type="module">
    // Wait for data to be loaded before proceeding
    const dataLoadPromise = new Promise((resolve) => {
        Revisit.onDataReceive((data) => {
            localStorage.setItem("measurements", JSON.stringify({
                condition_chart: data.condition_chart,
                condition_texture: data.condition_texture
            }));
            resolve();
        });
    });

    // Wait for data to be loaded
    await dataLoadPromise;

    // Now safely use the data
    let measurements = JSON.parse(localStorage.getItem('measurements'));
    let condition_chart = measurements['condition_chart'];
    let condition_texture = measurements['condition_texture'];
    console.log('condition_chart:' + condition_chart);
    console.log('condition_texture:' + condition_texture);

    // Initialize the page with the correct data
    let chartName;
    let data;
    
    // Move all the initialization code here
    switch (condition_chart) {
        case 0:
            switch (condition_texture){
                case 0:
                    //draw bar geo texture tool
                    chartName = 'barGeo';
                    drawToolbar('toolbar')
                    drawDragDropInfo('dragdrop')
                    document.getElementById('toolbar').appendChild(drawSelectDefaultGeoTexture())
                    drawChartDiv('chartDiv', svgWidth, svgHeight, 'chart')
                    geoTextures(d3.select('#chartA'),fruits)
                    drawGeoControllers()
                    break;
                case 1:
                    //draw bar icon texture tool
                    chartName = 'barIcon'

                    drawToolbar('toolbar')
                    drawDragDropInfo('dragdrop')
                    drawIconLegend('legend',fruits)
                    drawChartDiv('chartDiv', svgWidth, svgHeight, 'chart')
                    iconTextures(d3.select('#chartA'),fruits)
                    drawIconicControllers()

                    break;
            }
            break;
        case 1:
            switch (condition_texture){
                case 0:
                    //draw pie geo texture tool
                    chartName = "pieGeo"

                    drawToolbar('toolbar')
                    drawDragDropInfo('dragdrop')
                    document.getElementById('toolbar').appendChild(drawSelectDefaultGeoTexture())
                    drawChartDiv('chartDiv', svgWidth, svgHeight, 'chart')
                    geoTextures(d3.select('#chartA'),fruits)
                    drawGeoControllers()

                    break;
                case 1:
                    //draw pie icon texture tool
                    chartName = 'pieIcon'

                    drawToolbar('toolbar')
                    drawDragDropInfo('dragdrop')
                    drawIconLegend('legend',fruits)
                    drawChartDiv('chartDiv', svgWidth, svgHeight, 'chart')
                    iconTextures(d3.select('#chartA'),fruits)
                    drawIconicControllers()

                    break;
            }
            break;
        case 2:
            switch (condition_texture){
                case 0:
                    //draw map geo texture tool
                    chartName = "mapGeo"

                    drawToolbar('toolbar')
                    drawDragDropInfo('dragdrop')
                    document.getElementById('toolbar').appendChild(drawSelectDefaultGeoTexture())
                    drawChartDiv('chartDiv', svgWidth, svgHeight, 'chart')
                    geoTextures(d3.select('#chartA'),fruits)
                    drawGeoControllers()


                    break;
                case 1:
                    //draw map icon texture tool
                    chartName = "mapIcon"

                    drawToolbar('toolbar')
                    drawDragDropInfo('dragdrop')
                    drawIconLegend('legend',fruits)
                    drawChartDiv('chartDiv', svgWidth, svgHeight, 'chart')
                    iconTextures(d3.select('#chartA'),fruits)
                    drawIconicControllers()

                    break;
            }
            break;
        default:
            console.log(`has problem with condition_chart`);
    }

    // Initialize the tour after data is loaded
    if(localStorage.getItem('only_halo_tutorial') == -1){
        document.getElementById('tutorial_finished').style.display = 'block';
        document.getElementById('tutorial_next_btn').disabled = false;
    }

    let tour = new Tour({
        onEnd: function (){
            document.getElementById('tutorial_finished').style.display = 'block';
            document.getElementById('tutorial_next_btn').disabled = false;
        }
    });

    if(localStorage.getItem('only_halo_tutorial') == 1){ //if the participant already designed a bar chart, and this time they will design a pie or map, then we should notify them the halo controller
        //bootstrap-tour uses localStorage to store the progress. Remove the relevant variables to let the tour start again.
        if(localStorage.getItem('tour_current_step')){
            localStorage.removeItem('tour_current_step')
        }
        if(localStorage.getItem('tour_end')){
            localStorage.removeItem('tour_end')
        }

        tour.addStep({
            element: "#controlHalo",
            title: "Change the white halo width",
            content: "We see you have already did our study before, but this time there will be a halo controller. You can change the white halo width by using this controller. Try it out right now."
        })
        localStorage.setItem('only_halo_tutorial', '-1') //this halo tutorial will never show again.
    }

    if(localStorage.getItem('only_halo_tutorial') == 0){
        //if the texture order is geo-icon, we will see a tutorial for geo chart, and need the import default texture function.
        if(condition_texture == 0){
            tour.addStep({
                element: "#selectDefaultTexture", // string (jQuery selector) - html element next to which the step popover should be shown
                title: "Import default texture", // string - title of the popover
                content: "You can select and import a default texture in the drop-down box. This function is available only for geometric textures, the default textures are inspired by historic examples. Try it out right now." // string - content of the popover
            })
        }

        if(condition_chart == 2){ //for map, we say "texture in the map"
            tour.addStep({
                element: "#chart",
                title: "Select texture to edit(1)",
                content: "You can select each texture in the map to make edits by clicking on the texture on the chart. Try it out right now."
            })
        }else{ //for bar chart and pie chart, we say "texture in the chart"
            tour.addStep({
                element: "#chart",
                title: "Select texture to edit(1)",
                content: "You can select each texture in the chart to make edits by clicking on the texture on the chart. Try it out right now."
            })
        }
        tour.addSteps([{
            element: "#legend",
            title: "Select texture to edit(2)",
            content: "You can also select a texture to edit by clicking on the legend. Try it out right now."
        },  {
            element: "#controllerDiv",
            title: "Edit texture",
            content: "You can edit the parameters of the selected texture by using these controllers. Try it out right now."
        }, {
            element: "#chart",
            title: "Drag and drop to switch texture",
            content: "You can drag-and-drop from one texture to another on the chart or on the legend to switch the parameters of respective two textures. Try it out right now."
        },{
            element: "#controllerDiv",
            title: "Edit all texture texture at the same time",
            content: "If you check the checkbox after each parameter controller, you can change this parameter for all textures at the same time. Try it out right now."
        }, {
            element: "#controlOutline",
            title: "Change the outline stroke width",
            content: "You can change the outline stroke width by using this controller. Try it out right now."
        },
        ]);

        //if the chart type is not bar chart, we need the Halo controller
        if(condition_chart != 0){
            tour.addStep({
                element: "#controlHalo",
                title: "Change the white halo width",
                content: "You can change the white halo width by using this controller. Try it out right now."
            })
        }

        tour.addSteps([
            {
                element: "#dataBtn",
                title: "Change data set",
                content: "You can change to a different, randomly selected data set to test your design. Try it out right now."
            },{
                element: "#defaultDataBtn",
                title: "Default data set",
                content: "You can test your design with the default data set. Try it out right now."
            }, {
                element: "#undoBtn",
                title: "Undo",
                content: "You can undo your operation on texture attributes. Try it out right now."
            }, {
                element: "#redoBtn",
                title: "Redo",
                content: "You can redo your operation on texture attributes. Try it out right now."
            }, {
                element: "#resetBtn",
                title: "Reset",
                content: "You can also reset all texture attributes to the default that we started with, if needed. Try it out right now."
            }
        ])
    }

    // Initialize and start the tour
    tour.init();
    tour.start();
</script>

</body>
</html>





<!--bootstrap tour-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tour/0.11.0/js/bootstrap-tour-standalone.min.js"></script>-->
<!--<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-tour/0.11.0/css/bootstrap-tour-standalone.min.css" rel="stylesheet"/>-->



